.data
font:		.half
		##########################
		0xF00F, #--XXXX--   0000 1111 1111 0000    
		0x0C30, #-X----X-   0011 0000 0000 1100    
		0x0C30, #-X----X-   0011 0000 0000 1100    
		0x0C30, #-X----X-   0011 0000 0000 1100    
		0x0C30, #-X----X-   0011 0000 0000 1100    
		0x0C30, #-X----X-   0011 0000 0000 1100    
		0x0C30, #-X----X-   0011 0000 0000 1100    
		0xF00F, #--XXXX--   0000 1111 1111 0000    
		##########################
		0xC000, #----X---   0000 0000 1100 0000    
		0xC003, #---XX---   0000 0011 1100 0000   
		0xC00C, #--X-X---   0000 1100 1100 0000    
		0xC000, #----X---   0000 0000 1100 0000    
		0xC000, #----X---   0000 0000 1100 0000    
		0xC000, #----X---   0000 0000 1100 0000    
		0xC000, #----X---   0000 0000 1100 0000    
		0xFC3f, #-XXXXXX-   0011 1111 1111 1100   
		##########################
		0xF00F, #--XXXX--   0000 1111 1111 0000    
		0x0C30, #-X----X-   0011 0000 0000 1100    
		0x3000, #-----X--   0000 0000 0011 0000   
		0xC000, #----X---   0000 0000 1100 0000    
		0x0003, #---X----   0000 0011 0000 0000    
		0x000C, #--X-----   0000 1100 0000 0000    
		0x0030, #-X------   0011 0000 0000 0000    
		0xFC3F, #-XXXXXX-   0011 1111 1111 1100    
		##########################
		0xF03F, #-XXXXX--   0011 1111 1111 0000    
		0x0C00, #------X-   0000 0000 0000 1100    
		0x0C00, #------X-   0000 0000 0000 1100    
		0xF03F, #-XXXXX--   0011 1111 1111 0000    
		0x0C00, #------X-   0000 0000 0000 1100    
		0x0C00, #------X-   0000 0000 0000 1100    
		0x0C00, #------X-   0000 0000 0000 1100    
		0xFC3F, #-XXXXXX-   0011 1111 1111 1100    
		##########################
		0x0C00, #------X-   0000 0000 0000 1100    
		0xCC00, #----X-X-   0000 0000 1100 1100    
		0x0C03, #---X--X-   0000 0011 0000 1100    
		0x0C0C, #--X---X-   0000 1100 0000 1100    
		0xFC3F, #-XXXXXX-   0011 1111 1111 1100    
		0x0C00, #------X-   0000 0000 0000 1100    
		0x0C00, #------X-   0000 0000 0000 1100    
		0x0C00, #------X-   0000 0000 0000 1100    
		##########################
		0xFC3F, #-XXXXXX-   0011 1111 1111 1100    
		0x0030, #-X------   0011 0000 0000 0000    
		0x0030, #-X------   0011 0000 0000 0000    
		0xF03F, #-XXXXX--   0011 1111 1111 0000    
		0x0C00, #------X-   0000 0000 0000 1100    
		0x0C00, #------X-   0000 0000 0000 1100    
		0x0C00, #------X-   0000 0000 0000 1100    
		0xF03F, #-XXXXX--   0011 1111 1111 0000    
		##########################
		0x0C00, #-----X--   0000 0000 0000 1100    
		0x3000, #----X---   0000 0000 0011 0000    
		0x0003, #---X----   0000 0011 0000 0000    
		0xF00F, #--XXXX--   0000 1111 1111 0000
		0x0C30, #-X----X-   0011 0000 0000 1100    	
		0x0C30, #-X----X-   0011 0000 0000 1100    
		0x0C30, #-X----X-   0011 0000 0000 1100    
		0xF00F, #--XXXX--   0000 1111 1111 0000    
		##########################
		0xFC3F, #-XXXXXX-   0011 1111 1111 1100    
		0x0C00, #------X-   0000 0000 0000 1100    
		0x3000, #-----X--   0000 0000 0011 0000    
		0xC000, #----X---   0000 0000 1100 0000    
		0x0003, #---X----   0000 0011 0000 0000    
		0x000C, #--X-----   0000 1100 0000 0000    
		0x0030, #-X------   0011 0000 0000 0000    
		0x0030, #-X------   0011 0000 0000 0000    
		##########################
		0xF00F, #--XXXX--   0000 1111 1111 0000    
		0x0C30, #-X----X-   0011 0000 0000 1100    
		0x0C30, #-X----X-   0011 0000 0000 1100    
		0xF00F, #--XXXX--   0000 1111 1111 0000    
		0x0C30, #-X----X-   0011 0000 0000 1100    
		0x0C30, #-X----X-   0011 0000 0000 1100    
		0x0C30, #-X----X-   0011 0000 0000 1100   
		0xF00F, #--XXXX--   0000 1111 1111 0000    
		##########################
		0xF00F, #--XXXX--   0000 1111 1111 0000    
		0x0C30, #-X----X-   0011 0000 0000 1100    
		0x0C30, #-X----X-   0011 0000 0000 1100   
		0xFC0F, #--XXXXX-   0000 1111 1111 1100    
		0x0C00, #------X-   0000 0000 0000 1100    
		0x0C00, #------X-   0000 0000 0000 1100    
		0x0C00, #------X-   0000 0000 0000 1100    
		0xFC3F, #-XXXXXX-   0011 1111 1111 1100
		########################## (CARD 10)
		0xFC3F, #-XXXXXX-   0011 1111 1111 1100
		0xFC3F,	#-XXXXXX-   0011 1111 1111 1100
		0xFC3F,	#-XXXXXX-   0011 1111 1111 1100
		0xFC3F,	#-XXXXXX-   0011 1111 1111 1100
		0xFC3F,	#-XXXXXX-   0011 1111 1111 1100
		0xFC3F,	#-XXXXXX-   0011 1111 1111 1100
		0xFC3F,	#-XXXXXX-   0011 1111 1111 1100
		0xFC3F,	#-XXXXXX-   0011 1111 1111 1100
		########################## (CARD 11)
		0x0000, #--------   0000 0000 0000 0000
		0x3C3C, #-XX--XX-   0011 1100 0011 1100
		0x0000, #--------   0000 0000 0000 0000
	     	0x0C30, #-X----X-   0011 0000 0000 1100
		0x300C, #--X--X--   0000 1100 0011 0000
		0xC003, #---XX---   0000 0011 1100 0000
		0x0000, #--------   0000 0000 0000 0000
		0x0000, #--------   0000 0000 0000 0000
		########################## (CARD 12)
		0x0000, #--------   0000 0000 0000 0000
		0x3C3C, #-XX--XX-   0011 1100 0011 1100
		0x0000, #--------   0000 0000 0000 0000
		0xC003, #---XX---   0000 0011 1100 0000
		0x300C, #--x--X--   0000 1100 0011 0000
		0x0C30, #-X----X-   0011 0000 0000 1100
		0x0000, #--------   0000 0000 0000 0000
		0x0000, #--------   0000 0000 0000 0000
		########################## (CARD 13)
		0x0000, #--------   0000 0000 0000 0000
		0x0000, #--------   0000 0000 0000 0000
		0x0000, #--------   0000 0000 0000 0000
		0x0000, #--------   0000 0000 0000 0000
		0x0000, #--------   0000 0000 0000 0000
		0x0000, #--------   0000 0000 0000 0000
		0x0000, #--------   0000 0000 0000 0000
		0x0000, #--------   0000 0000 0000 0000
		########################## (CARD 14)
		0x0000, #--------   0000 0000 0000 0000
		0x0000, #--------   0000 0000 0000 0000
		0xC003, #---XX---   0000 0011 1100 0000
		0x0000, #--------   0000 0000 0000 0000
		0x0000, #--------   0000 0000 0000 0000
		0xC003, #---XX---   0000 0011 1100 0000
		0x0000, #--------   0000 0000 0000 0000
		0x0000  #--------   0000 0000 0000 0000

.text

la $s0, font

li $t5, 0	#Add 1 to this
li $t6, 0	#Add 16 to this
li $t9, 0	#Used to handle the address of which card is to be selected (0 for one, 16 for two, etc.)
li $t7, 0	#Counter for the number of rows
li $t8, 0	#Counter for the num of columns


jal card

desiredCard:
	add $s0, $s0, $t9	
	li $s1, 0xFFFF0098	#Load s6 with the memory address for row 1 and col 1
cardLoop:
	
	li $t3, 8
	lhu $t1, 0($s0)

	slt $t4, $t5, $t3	#counter t5 < 8
	beq $t4, $0, nextColumn	#If t5 > 8, then move to the next column
	
	sh $t1, 0($s1)
	
	jal setLED
	
	addi $s1, $s1, 16	#Decreases the row value
	addi $t5, $t5, 1	#Increment counter
	addi $s0, $s0, 2	#Go to next element in font array
	
	
	j cardLoop
	
#Subtracts 128 in order to move back to the original address (top line of the card)
#Adds 2 in order to move to the right two spaces
#Substracts 16 from s0, which has the address of the font array. This means it will keep displaying the same card
#Finally reset the counting register s5	
nextColumn:
	#If the num of rows is > 8, move to the next row
	addi $t8, $t8, 1
	slt $t4, $t8, $t3
	beq $t4, $0, nextRow
	
	subi $s1, $s1, 128
	addi $s1, $s1, 2
	subi $s0, $s0, 16
	li $t5, 0
	
	
	j cardLoop
	
#The address for the start of a row is (rum#)x(144)+base address
#Here I add 144 to $s3 everytime nextRow is executed so that it will always be the correct row number (sounds weird)
#Then I add $s3 to the base address	
nextRow:
	#Check if the number of rows is greater than 5
	addi $t7, $t7, 1	#If I don't do this first, then 6 rows are created
	slti $t4, $t7, 5
	beq $t4, $0, timeSetup
	
	
	addi $s3, $s3, 160
	li $s1, 0xFFFF0098
	add $s1, $s1, $s3
	subi $s0, $s0, 16	#Make sure that the blank card is the only card displayed
	li $t8, 0	#Reset both counter registers
	li $t5, 0
	
	j cardLoop
	

zero:
	li $t9, 0
	j endTime
	
one:
	li $t9, 16
	j endTime
	
two:
	addi $sp, $sp, -4
	sw $ra, 0($sp)
	
	li $t9, 32
	j endTime
three:
	addi $sp, $sp, -4
	sw $ra, 0($sp)
	
	li $t9, 48
	j endTime
four:
	addi $sp, $sp, -4
	sw $ra, 0($sp)
	
	li $t9, 64
	j endTime
five:
	li $t9, 80
	j endTime
							
six:
	addi $sp, $sp, -4
	sw $ra, 0($sp)
	
	li $t9, 96
	j endTime
seven:
	addi $sp, $sp, -4
	sw $ra, 0($sp)
	
	li $t9, 112
	j endTime
eight:
	addi $sp, $sp, -4
	sw $ra, 0($sp)
	
	li $t9, 128
	j endTime
nine:
	addi $sp, $sp, -4
	sw $ra, 0($sp)
	
	li $t9, 144
	j endTime
card:
	addi $sp, $sp, -4
	sw $ra, 0($sp)
	
	li $t9, 160
	j endTime	
smiley:
	addi $sp, $sp, -4
	sw $ra, 0($sp)
	
	li $t9, 176
	j endTime
frown:	
	addi $sp, $sp, -4
	sw $ra, 0($sp)
															
	li $t9, 192
	
blank:
	addi $sp, $sp, -4
	sw $ra, 0($sp)
	
	li $t9, 208
	j endTime	
colon:
	addi $sp, $sp, -4
	sw $ra, 0($sp)
	
	li $t9, 224
	j endTime	

nextColumnTime:
	slti $t4, $t8, 1
	beq $t4, $0, endTime
	addi $t8, $t8, 1
	
	subi $s1, $s1, 128
	addi $s1, $s1, 2
	subi $s0, $s0, 16
	li $t5, 0
	
	j timeDisplay
	
timeSetup:
	la $s0, font
	li $t5, 0	#Counter for when to switch columns
	li $t8, 0
	li $s1, 0xFFFF000E
	jal three
	add $s0, $s0, $t9
	
	jal timePrologue
	
	jal colon
	add $s0, $s0, $t9
	
	jal timePrologue
	
	j exit
	
timePrologue:
	addi $sp, $sp, -4
	sw $ra, 0($sp)
	
timeDisplay:	
	
	
	lhu $t1, 0($s0)
	slti $t4, $t5, 8	#counter t5 < 8
	beq $t4, $0, nextColumnTime	#If t5 > 8, then move to the next column
	
	sh $t1, 0($s1)
	
	jal setLED
	
	addi $s1, $s1, 16	#Decreases the row value
	addi $t5, $t5, 1	#Increment counter
	addi $s0, $s0, 2	#Go to next element in font array
	
	j timeDisplay
	
endTime:
	lw $ra, 0($sp)
	j return	
	
return:
	jr $ra	

exit:
	li $v0, 10
	syscall

setLED:
	# byte offset into display = y * 16 bytes + (x / 4)
	sll	$t0,$a1,4      # y * 16 bytes
	srl	$t1,$a0,2      # x / 4
	add	$t0,$t0,$t1    # byte offset into display
	li	$t2,0xffff0008	# base address of LED display
	add	$t0,$t2,$t0    # address of byte with the LED
	# now, compute led position in the byte and the mask for it
	andi	$t1,$a0,0x3    # remainder is led position in byte
	neg	$t1,$t1        # negate position for subtraction
	addi	$t1,$t1,3      # bit positions in reverse order
	sll	$t1,$t1,1      # led is 2 bits
	# compute two masks: one to clear field, one to set new color
	li	$t2,3		
	sllv	$t2,$t2,$t1
	not	$t2,$t2        # bit mask for clearing current color
	sllv	$t1,$a2,$t1    # bit mask for setting color
	# get current LED value, set the new field, store it back to LED
	lbu	$t3,0($t0)     # read current LED value	
	and	$t3,$t3,$t2    # clear the field for the color
	or	$t3,$t3,$t1    # set color field
	sb	$t3,0($t0)     # update display
	jr	$ra	


